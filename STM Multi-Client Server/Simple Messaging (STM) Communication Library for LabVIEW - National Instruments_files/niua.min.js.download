(function(a,e){"object"===typeof exports&&"undefined"!==typeof module?module.exports=e():"function"===typeof define&&define.amd?define(e):a.ES6Promise=e()})(this,function(){function a(){return function(){return process.nextTick(q)}}function e(){return function(){Q(q)}}function g(){var b=0,c=new R(q),l=document.createTextNode("");c.observe(l,{characterData:!0});return function(){l.data=b=++b%2}}function d(){var b=new MessageChannel;b.port1.onmessage=q;return function(){return b.port2.postMessage(0)}}
function m(){var b=setTimeout;return function(){return b(q,1)}}function q(){for(var b=0;b<x;b+=2)(0,y[b])(y[b+1]),y[b]=void 0,y[b+1]=void 0;x=0}function K(){try{var b=require("vertx");Q=b.runOnLoop||b.runOnContext;return e()}catch(c){return m()}}function C(b,c){var l=arguments,a=this,d=new this.constructor(r);void 0===d[H]&&S(d);var f=a._state;f?function(){var b=l[f-1];v(function(){return T(f,d,b,a._result)})}():L(a,d,b,c);return d}function w(b){if(b&&"object"===typeof b&&b.constructor===this)return b;
var c=new this(r);D(c,b);return c}function r(){}function n(b){try{return b.then}catch(c){return I.error=c,I}}function z(b,c,l,a){try{b.call(c,l,a)}catch(Z){return Z}}function t(b,c,a){v(function(b){var l=!1,d=z(a,c,function(a){l||(l=!0,c!==a?D(b,a):f(b,a))},function(c){l||(l=!0,k(b,c))},"Settle: "+(b._label||" unknown promise"));!l&&d&&(l=!0,k(b,d))},b)}function M(b,c){c._state===E?f(b,c._result):c._state===A?k(b,c._result):L(c,void 0,function(c){return D(b,c)},function(c){return k(b,c)})}function h(b,
c,a){c.constructor===b.constructor&&a===C&&c.constructor.resolve===w?M(b,c):a===I?k(b,I.error):void 0===a?f(b,c):"function"===typeof a?t(b,c,a):f(b,c)}function D(b,c){b===c?k(b,new TypeError("You cannot resolve a promise with itself")):"function"===typeof c||"object"===typeof c&&null!==c?h(b,c,n(c)):f(b,c)}function aa(b){b._onerror&&b._onerror(b._result);u(b)}function f(b,c){b._state===B&&(b._result=c,b._state=E,0!==b._subscribers.length&&v(u,b))}function k(b,c){b._state===B&&(b._state=A,b._result=
c,v(aa,b))}function L(b,c,a,d){var l=b._subscribers,f=l.length;b._onerror=null;l[f]=c;l[f+E]=a;l[f+A]=d;0===f&&b._state&&v(u,b)}function u(b){var c=b._subscribers,a=b._state;if(0!==c.length){for(var d,f,e=b._result,h=0;h<c.length;h+=3)d=c[h],f=c[h+a],d?T(a,d,f,e):f(e);b._subscribers.length=0}}function U(){this.error=null}function T(b,c,a,d){var l="function"===typeof a,h=void 0,e=void 0,g=void 0,G=void 0;if(l){try{h=a(d)}catch(ba){N.error=ba,h=N}h===N?(G=!0,e=h.error,h=null):g=!0;if(c===h){k(c,new TypeError("A promises callback cannot return that same promise."));
return}}else h=d,g=!0;c._state===B&&(l&&g?D(c,h):G?k(c,e):b===E?f(c,h):b===A&&k(c,h))}function ca(b,c){try{c(function(c){D(b,c)},function(c){k(b,c)})}catch(l){k(b,l)}}function S(b){b[H]=V++;b._state=void 0;b._result=void 0;b._subscribers=[]}function F(b,c){this._instanceConstructor=b;this.promise=new b(r);this.promise[H]||S(this.promise);W(c)?(this._input=c,this._remaining=this.length=c.length,this._result=Array(this.length),0===this.length?f(this.promise,this._result):(this.length=this.length||0,
this._enumerate(),0===this._remaining&&f(this.promise,this._result))):k(this.promise,Error("Array Methods must be provided an Array"))}function p(b){this[H]=V++;this._result=this._state=void 0;this._subscribers=[];if(r!==b){if("function"!==typeof b)throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(this instanceof p)ca(this,b);else throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");
}}function X(){var b=void 0;if("undefined"!==typeof global)b=global;else if("undefined"!==typeof self)b=self;else try{b=Function("return this")()}catch(G){throw Error("polyfill failed because global object is unavailable in this environment");}var c=b.Promise;if(c){var a=null;try{a=Object.prototype.toString.call(c.resolve())}catch(G){}if("[object Promise]"===a&&!c.cast)return}b.Promise=p}var O=void 0,W=O=Array.isArray?Array.isArray:function(b){return"[object Array]"===Object.prototype.toString.call(b)},
x=0,Q=void 0,P=void 0,v=function(b,c){y[x]=b;y[x+1]=c;x+=2;2===x&&(P?P(q):Y())},J=(O="undefined"!==typeof window?window:void 0)||{},R=J.MutationObserver||J.WebKitMutationObserver;J="undefined"===typeof self&&"undefined"!==typeof process&&"[object process]"==={}.toString.call(process);var da="undefined"!==typeof Uint8ClampedArray&&"undefined"!==typeof importScripts&&"undefined"!==typeof MessageChannel,y=Array(1E3),Y=void 0;Y=J?a():R?g():da?d():void 0===O&&"function"===typeof require?K():m();var H=
Math.random().toString(36).substring(16),B=void 0,E=1,A=2,I=new U,N=new U,V=0;F.prototype._enumerate=function(){for(var b=this.length,c=this._input,a=0;this._state===B&&a<b;a++)this._eachEntry(c[a],a)};F.prototype._eachEntry=function(b,c){var a=this._instanceConstructor,d=a.resolve;d===w?(d=n(b),d===C&&b._state!==B?this._settledAt(b._state,c,b._result):"function"!==typeof d?(this._remaining--,this._result[c]=b):a===p?(a=new a(r),h(a,b,d),this._willSettleAt(a,c)):this._willSettleAt(new a(function(c){return c(b)}),
c)):this._willSettleAt(d(b),c)};F.prototype._settledAt=function(b,c,a){var d=this.promise;d._state===B&&(this._remaining--,b===A?k(d,a):this._result[c]=a);0===this._remaining&&f(d,this._result)};F.prototype._willSettleAt=function(b,c){var a=this;L(b,void 0,function(b){return a._settledAt(E,c,b)},function(b){return a._settledAt(A,c,b)})};p.all=function(b){return(new F(this,b)).promise};p.race=function(b){var a=this;return W(b)?new a(function(c,d){for(var h=b.length,f=0;f<h;f++)a.resolve(b[f]).then(c,
d)}):new a(function(b,a){return a(new TypeError("You must pass an array to race."))})};p.resolve=w;p.reject=function(b){var a=new this(r);k(a,b);return a};p._setScheduler=function(b){P=b};p._setAsap=function(b){v=b};p._asap=v;p.prototype={constructor:p,then:C,"catch":function(b){return this.then(null,b)}};X();p.polyfill=X;return p.Promise=p});"object"!==typeof JSON&&(JSON={});
(function(){function a(a){return 10>a?"0"+a:a}function e(){return this.valueOf()}function g(a){w.lastIndex=0;return w.test(a)?'"'+a.replace(w,function(a){var d=M[a];return"string"===typeof d?d:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function d(a,e){var h=n,f=e[a];f&&"object"===typeof f&&"function"===typeof f.toJSON&&(f=f.toJSON(a));"function"===typeof t&&(f=t.call(e,a,f));switch(typeof f){case "string":return g(f);case "number":return isFinite(f)?String(f):"null";case "boolean":case "null":return String(f);
case "object":if(!f)return"null";n+=z;var k=[];if("[object Array]"===Object.prototype.toString.apply(f)){var m=f.length;for(a=0;a<m;a+=1)k[a]=d(a,f)||"null";e=0===k.length?"[]":n?"[\n"+n+k.join(",\n"+n)+"\n"+h+"]":"["+k.join(",")+"]";n=h;return e}if(t&&"object"===typeof t)for(m=t.length,a=0;a<m;a+=1){if("string"===typeof t[a]){var u=t[a];(e=d(u,f))&&k.push(g(u)+(n?": ":":")+e)}}else for(u in f)Object.prototype.hasOwnProperty.call(f,u)&&(e=d(u,f))&&k.push(g(u)+(n?": ":":")+e);e=0===k.length?"{}":n?
"{\n"+n+k.join(",\n"+n)+"\n"+h+"}":"{"+k.join(",")+"}";n=h;return e}}var m=/^[\],:{}\s]*$/,q=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,K=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,C=/(?:^|:|,)(?:\s*\[)+/g,w=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,r=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;"function"!==typeof Date.prototype.toJSON&&
(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=e,Number.prototype.toJSON=e,String.prototype.toJSON=e);var n,z,t;if("function"!==typeof JSON.stringify){var M={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};JSON.stringify=function(a,e,g){var f;z=n="";if("number"===
typeof g)for(f=0;f<g;f+=1)z+=" ";else"string"===typeof g&&(z=g);if((t=e)&&"function"!==typeof e&&("object"!==typeof e||"number"!==typeof e.length))throw Error("JSON.stringify");return d("",{"":a})}}"function"!==typeof JSON.parse&&(JSON.parse=function(a,d){function e(a,g){var f,h=a[g];if(h&&"object"===typeof h)for(f in h)if(Object.prototype.hasOwnProperty.call(h,f)){var k=e(h,f);void 0!==k?h[f]=k:delete h[f]}return d.call(a,g,h)}a=String(a);r.lastIndex=0;r.test(a)&&(a=a.replace(r,function(a){return"\\u"+
("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(m.test(a.replace(q,"@").replace(K,"]").replace(C,"")))return a=eval("("+a+")"),"function"===typeof d?e({"":a},""):a;throw new SyntaxError("JSON.parse");})})();var timer,varNIUA,niupSessionUpdateTime,niupLastActivityTime;function NIUA(a){this.appConfig=a}NIUA.getNIUA=function(a){a.hasOwnProperty("minutesBeforeExpire")||(a.minutesBeforeExpire=5);a.hasOwnProperty("apikey")||(a.apikey="there_is_no_apikey");return new NIUA(a)};
NIUA.prototype.ready=function(){return new Promise(function(a,e){console.log("NIUA instance has been initialized.");a()})};NIUA.prototype.isIE=function(){ua=navigator.userAgent;return-1<ua.indexOf("MSIE ")||-1<ua.indexOf("Trident/")};NIUA.prototype.getCookie=function(a){a+="=";for(var e=document.cookie.split(";"),g=0;g<e.length;g++){for(var d=e[g];" "==d.charAt(0);)d=d.substring(1);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null};
NIUA.prototype.getSession=function(){var a=this;return new Promise(function(e,g){g=a.getCookie("profile_id");e(null!=g?{loggedIn:!0,profileId:g}:{loggedIn:!1})})};
NIUA.prototype.getEmail=function(){var a=this;return new Promise(function(e,g){var d={};if(null!=a.getCookie("profile_id"))if(sessionStorage.getItem("NIUA_email_addr")){g=JSON.parse(sessionStorage.getItem("NIUA_email_addr"));var m=(new Date).getTime()-6E4*a.appConfig.minutesBeforeExpire;parseInt(g.timestamp)<m?(d=JSON.parse(sessionStorage.getItem("NIUA_email_addr")),a.getResponse().then(function(a){d={response:a,timestamp:(new Date).getTime()};sessionStorage.setItem("NIUA_email_addr",JSON.stringify(d))})["catch"](function(a){d=
{response:{email:"webservice_error",success:!1},timestamp:(new Date).getTime()};console.log(a)})):d=JSON.parse(sessionStorage.getItem("NIUA_email_addr"));e(d)}else a.getResponse().then(function(a){d={response:a,timestamp:(new Date).getTime()};sessionStorage.setItem("NIUA_email_addr",JSON.stringify(d));e(d)})["catch"](function(a){d={response:{email:"webservice_error",success:!1},timestamp:(new Date).getTime()};console.log(a);e(d)});else d={response:{email:"user_not_logged_in",success:!1},timestamp:(new Date).getTime()},
sessionStorage.removeItem("NIUA_email_addr"),e(d)})};NIUA.prototype.getEnvFromUrl=function(){return-1<location.hostname.indexOf("-test2")?"-test2":-1<location.hostname.indexOf("-test")?"-test":-1<location.hostname.indexOf("-dev2")?"-dev2":-1<location.hostname.indexOf("-dev")?"-dev":""};
NIUA.prototype.getResponse=function(){var a=this;return new Promise(function(e,g){var d=new XMLHttpRequest;d.open("GET","//flux"+a.getEnvFromUrl()+".ni.com/niuadataservice/1/resources/email");d.withCredentials=!0;a.addAuthorization(d);a.addApiKey(d);d.onreadystatechange=function(){4===d.readyState&&(200===d.status?e(JSON.parse(d.response)):g(JSON.parse(d.response)))};d.send()})};
NIUA.prototype.createNIAuthToken=function(){var a=this.getCookie("profile_id"),e=this.getCookie("rma"),g=this.getCookie("rmac"),d=this.getCookie("upsid");return null!=this.getCookie("profile_id")?(null==e&&(e=""),null==g&&(g=""),null==d&&(d=""),"1|"+btoa(a+"|"+e+"|"+g+"|"+d)):null};NIUA.prototype.addAuthorization=function(a){var e=this.createNIAuthToken();null!=e&&a.setRequestHeader("X-NI-Auth-Token",e)};
NIUA.prototype.addApiKey=function(a){void 0!=this.appConfig.apikey&&null!=this.appConfig.apikey&&a.setRequestHeader("X-NI-API-KEY",this.appConfig.apikey)};
NIUA.prototype.callUpdateSession=function(a){var e=this;return new Promise(function(g,d){var m=new XMLHttpRequest,q=JSON.stringify(a);m.open("POST","//flux"+e.getEnvFromUrl()+".ni.com/niuadataservice/1/resources/updateSession");m.withCredentials=!0;e.addAuthorization(m);e.addApiKey(m);m.setRequestHeader("Content-Type","application/json; charset=utf-8");m.setRequestHeader("Accept","application/json");m.onreadystatechange=function(){4===m.readyState&&(201===m.status?g(JSON.parse(m.response)):d(JSON.parse(m.response)))};
m.send(q)})};NIUA.prototype.updateSession=function(){niupSessionUpdateTime=(new Date).getTime();var a=varNIUA.getCookie("upsid");if(null!=a)varNIUA.callUpdateSession({upsid:a,timestamp:niupLastActivityTime}).then(function(a){varNIUA.setTimer(a.relativeTimeout)})["catch"](function(a){console.log(a)})};NIUA.prototype.setNIUPActivity=function(){niupLastActivityTime=(new Date).getTime()};
NIUA.prototype.setTimer=function(a){void 0==timer?timer=setTimeout(varNIUA.updateSession,6E4*(a-1)):(a=niupLastActivityTime+3E4*(a-1)-niupSessionUpdateTime,0<a&&(timer=setTimeout(varNIUA.updateSession,a)))};
$(document).ready(function(){NIUA.prototype.getCookie("profile_id")||sessionStorage.removeItem("NIUA_email_addr");varNIUA=NIUA.getNIUA({minutesBeforeExpire:2,apikey:"3b7c1d3b-275d-4683-a459-36e3d1d21776"});varNIUA.setNIUPActivity();varNIUA.updateSession();window.addEventListener?(window.addEventListener("click",function(){varNIUA.setNIUPActivity()},!1),window.addEventListener("touchstart",function(){varNIUA.setNIUPActivity()},!1),window.addEventListener("keypress",function(){varNIUA.setNIUPActivity()},
!1)):(window.attachEvent("onclick",function(){varNIUA.setNIUPActivity()}),window.attachEvent("ontouchstart",function(){varNIUA.setNIUPActivity()}),window.attachEvent("onkeypress",function(){varNIUA.setNIUPActivity()}))});

